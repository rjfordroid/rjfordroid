<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-58748S9Z');</script>
<!-- End Google Tag Manager -->

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4800728968697075"
     crossorigin="anonymous"></script>

<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="cours.css">

<title>RJFORDROID ‚Äì Chaine WhatsApp pour apprendre l'informatique Android</title>

<!-- Favicon / Icon -->
<link rel="icon" href="logo1.png" type="image/x-icon">
<link rel="shortcut icon" href="logo1.png" type="image/x-icon">
<link rel="apple-touch-icon" href="logo1.png">

<meta name="google-adsense-account" content="ca-pub-4800728968697075">
<meta name="description" content="RJFORDROID est une chaine WhatsApp d√©di√©e √† l‚Äôapprentissage de l‚Äôinformatique sur Android : programmation, astuces, s√©curit√© et formations chaque semaine.">
<meta name="keywords" content="RJFORDROID, chaine WhatsApp informatique, apprendre informatique Android, programmation Android, astuces Android, formation informatique WhatsApp">
<meta name="author" content="RJFORDROID">
<meta name="robots" content="index, follow">

<link rel="canonical" href="https://rjfordroid.netlify.app/chaine/rjfordroid">

<!-- Open Graph -->
<meta property="og:title" content="RJFORDROID ‚Äì Apprendre l'informatique sur Android">
<meta property="og:description" content="Rejoins la chaine WhatsApp RJFORDROID pour apprendre l‚Äôinformatique sur Android, avec des formations pratiques chaque semaine.">
<meta property="og:url" content="https://rjfordroid.netlify.app/chaine/rjfordroid">
<meta property="og:type" content="website">
<meta property="og:image" content="image.png">

<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="RJFORDROID ‚Äì Informatique Android">
<meta name="twitter:description" content="Astuces, programmation et formations Android chaque semaine sur WhatsApp.">
<meta name="twitter:image" content="image.png">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<link rel="stylesheet" href="user.css">
<link rel="stylesheet" href="rj.css">
<link rel="stylesheet" href="chat.css">
</head>
<body>
  <!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-58748S9Z"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

<main>
   <section id="home" class="tab active">
     <div id="homeCategories"></div>
     <div class="headerHome">
         <h2>RJFORDROID</h2>
    <p>Cours informatique sur Android chaque semaine et astuces pour am√©liorer vos comp√©tences.</p>
    <button class="download">T√©l√©charger RJFORDROID</button>
     </div>
  <div id="homeContent" style="font-family:'Times New Roman', serif; font-size:14px;">
    <!-- Espas videyo -->
<div id="videoSpace" style="margin:10px 0; border:1px solid #ccc; border-radius:6px; padding:5px; height:180px; background:#f9f9f9; display:flex; align-items:center; justify-content:center;">
      üé• Votre vid√©o ici
    </div>

    <div>
      <h1 id="homet"></h1>
      <p id="homes"></p>
    </div>
    
        <!-- Nombre atik nan lis la -->
        <div class="flex">
          <p class="articleCount"><span>Artickes</span>
          </br>
          <span id="articleCount">0</span></p>
          
          <p class="articleCount"><span>Users</span>
          </br>
          <span id="userCount">0</span></p>
          
          <p class="articleCount"><span>Livres</span>
          </br>
          <span id="livreCount">0</span></p>
        </div>

<h3>Mes r√©seaux sociaux</h3>

<div class="card">
  <div onclick="window.open('https://www.youtube.com/@RJFORDROID', '_blank')" class="itemCard youtube">
    <span>YouTube</span>
    <i class="fa-brands fa-youtube"></i>
  </div>

  <div onclick="window.open('https://facebook.com/rjfordroid', '_blank')" class="itemCard facebook">
    <span>Facebook</span>
    <i class="fa-brands fa-facebook"></i>
  </div>
  
  <!-- Bouton abonne -->
    <div class="itemCard whatsapp" id="btnSubscribe">
          <span>Whatsapp</span>
        
    <i class="fa-brands fa-whatsapp"></i>
    </div>
</div>

  </div>

  
</section>

<section id="cours" class="tab">
        <!-- BOUTON MES COURS -->
  <button id="btn-mes-cours" style="margin:10px;padding:10px 15px;background:#2563eb;color:white;border:none;border-radius:5px;cursor:pointer;">
    Mes cours
  </button>

  <!-- CATALOGUE -->
  <section class="mesCours" id="mes-cours-section">
    <div id="catalogue-cours" class="course-grid"></div>
    <div id="catalogue-loading" class="catalogue-loading">
      <div class="spinner"></div>
      <p>Chargement des cours‚Ä¶</p>
    </div>
  </section>

  <!-- COURS INSCRIT CACHE -->
  <div id="courInscrit" style="display:none; padding:10px;"></div>
    <script>
      
      const btnMesCours = document.getElementById("btn-mes-cours");
const courInscrit = document.getElementById("courInscrit");
const mesCoursSection = document.getElementById("mes-cours-section");

btnMesCours.onclick = async () => {
  // Cacher catalogue, montrer coursInscrit
  mesCoursSection.style.display = "none";
  btnMesCours.style.display = "none";
  courInscrit.style.display = "block";
  await afficherCoursInscrits();

  // Ajouter bouton back si pa gen deja
  if (!document.getElementById("back-to-mescours")) {
    const backBtn = document.createElement("button");
    backBtn.id = "back-to-mescours";
    backBtn.innerText = "‚Üê Retour aux cours";
    backBtn.style.margin = "10px";
    backBtn.style.padding = "8px 12px";
    backBtn.style.background = "#1e293b";
    backBtn.style.color = "#fff";
    backBtn.style.border = "none";
    backBtn.style.borderRadius = "5px";
    backBtn.style.cursor = "pointer";

    backBtn.onclick = () => {
      courInscrit.style.display = "none";
      mesCoursSection.style.display = "block";
  btnMesCours.style.display = "block";
      
    };

    courInscrit.prepend(backBtn);
  }
};
      
      async function afficherCoursInscrits() {
  const div = document.getElementById("courInscrit");
  if (!div) return;

  div.innerHTML = "<p>Chargement...</p>";

  const uid = localStorage.getItem("connectedUID");
  if (!uid) {
    div.innerHTML = "<p>Utilisateur non connect√©</p>";
    return;
  }

  const userSnap = await database.ref("RJFORDROID/USERS/" + uid).once("value");
  const user = userSnap.val();

  if (!user || !user.mes_cours) {
    div.innerHTML = "<p>Aucun cours inscrit.</p>";
    return;
  }

  const coursSnap = await database.ref("RJFORDROID/COURE").once("value");
  if (!coursSnap.exists()) {
    div.innerHTML = "<p>Aucun cours trouv√©.</p>";
    return;
  }

  div.innerHTML = "";

  Object.keys(user.mes_cours).forEach(courseId => {
    const cours = coursSnap.child(courseId).val();
    if (!cours) return;

    const totalLessons = Object.keys(cours.lessons || {}).length;
    const doneLessons = Object.keys(
      user.mes_cours[courseId].lessons || {}
    ).length;

    const progression = totalLessons
      ? Math.round((doneLessons / totalLessons) * 100)
      : 0;

    const card = document.createElement("div");
    card.className = "course-card inscrit";

    card.innerHTML = `
      <h4>${cours.NomCours || "Sans titre"}</h4>
      <p>${cours.DesCours || ""}</p>

      <div style="display:flex; gap:10px;">
        <small>üìò ${totalLessons} le√ßons</small>
        <small>üìä ${progression}%</small>
      </div>

      <button onclick="ouvrirCours('${courseId}')">
        Continuer
      </button>
    `;

    div.appendChild(card);
  });
}
function ouvrirCours(courseId) {
  window.location.href = `lecon.html?id=${courseId}`;
}
    </script>
</section>

  <section id="list" class="tab">
    <div class="listCategories" style="display:flex;gap:8px;overflow-x:auto;margin-bottom:10px;"></div>
    <div id="listData"></div>

<div id="detailList" class="hidden">
  <button id="backBtn">‚¨Ö Back</button>
  <h2 id="dTitle"></h2>
  <p style="display:none;" id="dSummary"></p>

  <img id="dImage" />
  <video id="dVideo" controls></video>
  <audio id="dAudio" controls></audio>

  <div id="dDescription"></div>
</div>
  </section>
  
 <!-- CHAT SECTION -->
<section id="chat" class="tab">
  <div class="chat-sidebar-toggle">
    <button id="toggleClientsBtn">Clients üë•</button>
  </div>

  <div class="chat-wrapper">
    <!-- LISTE CLIENTS (Sidebar) -->
    <div class="chatClientEtAdm sidebar"></div>

    <!-- CHAT CONTAINER -->
    <div class="chat-container">
      <div class="chat-area" id="chatArea">
        <div class="welcome-message">
          <h3>Byenvini nan s√®vis premium Natcom</h3>
          <p>Chattez avec nos agents en temps r√©el! Chaque message co√ªte 1 cr√©dit. Vous avez actuellement <strong id="welcomeCredits">0 cr√©dits</strong>.</p>
        </div>
      </div>

      <div class="input-area">
        <button class="attachment-button" id="attachBtn"><i class="fas fa-paperclip"></i></button>
        <input type="text" class="message-input" id="messageInput" placeholder="Tapez votre message ici (1 cr√©dit par message)...">
        <button class="send-button" id="sendBtn" disabled><i class="fas fa-paper-plane"></i></button>
      </div>
      <div class="cost-indicator" id="costIndicator">Co√ªt: 1 cr√©dit | Cr√©dits restants: <span id="remainingCredits">0</span></div>
    </div>
  </div>
</section>

<section id="admin" class="tab">
  <h2><a href="AdmChaine.html">Adm</a></h2>
<div class="atabbtn">
  <button id="toggleClientsBtns">Client</button>
  <button data-target="tabApp">App</button>
  <button data-target="tabVideos">Videos</button>
  <button data-target="tabPays">Pays</button>
  <button data-target="tabPages">Pages</button>
  <button data-target="tabOnline">Online</button>
  <button data-target="tabBrowsers">Browser</button>
</div>

<div id="statsContainer" class="stats-container">
  <h2>üìä Statistiques en temps r√©el</h2>

  <div class="atab" id="tabApp" style="display:flex; flex-direction:column; gap:10px; max-width:400px; margin:20px;">
    <input type="text" id="t" placeholder="title">
    <input type="text" id="urlVideo" placeholder="Video ID/URL" style="padding:5px;">
    <textarea id="s" placeholder="R√©sum√©" style="padding:5px;"></textarea>
    <label>
      <input type="checkbox" id="onlineVideo"> Online
    </label>
    <button id="btnAddVideo" style="padding:6px 12px; background:#007bff; color:#fff; border:none; border-radius:4px; cursor:pointer;">
      Ajouter Video
    </button>
    <p id="msgVideo" style="color:green; font-weight:bold;"></p>
  </div>

  <div class="atab" id="tabVideos" style="max-width:500px; margin:20px; display:flex; flex-direction:column; gap:10px;">
    <div id="videoList"></div>
  </div>

  <div class="atab" id="tabPays">
    <h3>üåç Pays</h3>
    <ul id="statsListPays" class="stats-list"></ul>
  </div>
  
  <div class="atab" id="tabPages">
    <h3>üìÑ Pages les plus visit√©es</h3>
    <ul id="statsListPages" class="stats-list"></ul>
  </div>
  
  <div class="atab" id="tabOnline">
    <h3>üü¢ Utilisateurs en ligne</h3>
    <ul id="statsListUserOnline" class="stats-list"></ul>
  </div>
  
  <div class="atab" id="tabBrowsers">
    <h3>üß≠ Navigateurs</h3>
    <ul id="statsListBrowsers" class="stats-list"></ul>
  </div>
</div>

<script>
const tabButtons = document.querySelectorAll('.atabbtn button');
const tabs = document.querySelectorAll('.atab');

tabButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    // Retire active sou tout bouton
    tabButtons.forEach(b => b.classList.remove('active'));
    btn.classList.add('active');

    // Kache tout tab
    tabs.forEach(t => {
      t.classList.remove('active');
      t.style.display = 'none';
    });

    // Montre tab ki koresponn ak data-target
    const targetId = btn.dataset.target;
    const targetTab = document.getElementById(targetId);
    if(targetTab) {
      targetTab.style.display = 'flex';
      targetTab.classList.add('active');
    }
  });
});

// Inisyalize premye tab k√≤m aktif
if(tabButtons.length > 0) tabButtons[0].click();
</script>

<style>
.atabbtn button.active {
  background-color: #007bff;
  color: #fff;
}
.atabbtn button {
  padding: 6px 12px;
  margin-right: 5px;
  cursor: pointer;
  border: 1px solid #007bff;
  border-radius: 4px;
  background: #fff;
  color: #007bff;
}
</style>
</section>

</main>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="config.js"></script>
<script src="user.js"></script>
<script src="cours.js"></script>
<script src="chat.js"></script>
<script src="visite.js"></script>


<script>
document.addEventListener("DOMContentLoaded", function () {

  /* ===============================
     üî• Firebase Reference
  =============================== */
  const dbVideoRef = firebase.database().ref("RJFORDROID/VIDEO/Home/");

  /* ===============================
     üî• DOM Elements
  =============================== */
  const titleInput   = document.getElementById("t");
  const urlInput     = document.getElementById("urlVideo");
  const summaryInput = document.getElementById("s");
  const onlineCheckbox = document.getElementById("onlineVideo");
  const btnAdd = document.getElementById("btnAddVideo");
  const msgVideo = document.getElementById("msgVideo");
  const videoList = document.getElementById("videoList");

  let editingId = null;

  /* ===============================
     üîπ Utils
  =============================== */
  function showMessage(text, color = "green") {
    msgVideo.style.color = color;
    msgVideo.textContent = text;
    setTimeout(() => msgVideo.textContent = "", 3000);
  }

  function resetForm() {
    titleInput.value = "";
    urlInput.value = "";
    summaryInput.value = "";
    onlineCheckbox.checked = false;
    editingId = null;
    btnAdd.textContent = "Ajouter Video";
    btnAdd.style.background = "#007bff";
    titleInput.focus();
  }

  /* ===============================
     üîπ Add / Update Video
  =============================== */
  btnAdd.addEventListener("click", () => {
    const title = titleInput.value.trim();
    const url = urlInput.value.trim();
    const summary = summaryInput.value.trim();
    const online = onlineCheckbox.checked;

    if (!title || !url) {
      showMessage("‚ùå Titre et URL obligatoires", "red");
      return;
    }

    const data = {
      title,
      url,
      summary,
      online,
      updatedAt: Date.now()
    };

    if (editingId) {
      dbVideoRef.child(editingId).update(data).then(() => {
        showMessage("‚úÖ Vid√©o mise √† jour");
        resetForm();
      });
    } else {
      data.createdAt = Date.now();
      dbVideoRef.push(data).then(() => {
        showMessage("‚úÖ Vid√©o ajout√©e");
        resetForm();
      });
    }
  });

  /* ===============================
     üîπ Render List
  =============================== */
  function renderVideoList(data) {
    videoList.innerHTML = "";

    if (!data) {
      videoList.innerHTML = "<p>Aucune vid√©o</p>";
      return;
    }

    Object.entries(data).reverse().forEach(([id, video]) => {
      const div = document.createElement("div");
      div.style.border = "1px solid #ccc";
      div.style.borderRadius = "8px";
      div.style.padding = "10px";
      div.style.background = video.online ? "#eaffea" : "#f9f9f9";

      div.innerHTML = `
        <h4>${video.title}</h4>
        <p>${video.summary || ""}</p>
        <small>${video.url}</small>

        <label>
          <input type="checkbox" class="onlineChk" ${video.online ? "checked" : ""}>
          Online
        </label>

        <div style="display:flex; gap:8px; margin-top:6px;">
          <button class="editBtn">‚úèÔ∏è Edit</button>
          <button class="deleteBtn">üóëÔ∏è Delete</button>
        </div>
      `;

      /* üî• EDIT */
      div.querySelector(".editBtn").addEventListener("click", () => {
        titleInput.value = video.title || "";
        urlInput.value = video.url || "";
        summaryInput.value = video.summary || "";
        onlineCheckbox.checked = !!video.online;

        editingId = id;
        btnAdd.textContent = "Mettre √† jour";
        btnAdd.style.background = "#28a745";

        titleInput.scrollIntoView({ behavior: "smooth" });
        titleInput.focus();
      });

      /* üî• DELETE */
      div.querySelector(".deleteBtn").addEventListener("click", () => {
        if (confirm("Supprimer cette vid√©o ?")) {
          dbVideoRef.child(id).remove();
          showMessage("üóëÔ∏è Vid√©o supprim√©e", "orange");
        }
      });

      /* üî• ONLINE SWITCH */
      div.querySelector(".onlineChk").addEventListener("change", e => {
        dbVideoRef.child(id).update({
          online: e.target.checked,
          updatedAt: Date.now()
        });
      });

      videoList.appendChild(div);
    });
  }

  /* ===============================
     üîπ Firebase Listener
  =============================== */
  dbVideoRef.on("value", snap => {
    renderVideoList(snap.val());
  });

  /* ===============================
     üîπ ESC = cancel edit
  =============================== */
  document.addEventListener("keydown", e => {
    if (e.key === "Escape" && editingId) {
      resetForm();
      showMessage("‚ùé Modification annul√©e", "gray");
    }
  });

});
</script>
<!-- CONFIGURATION ET FONCTIONNALIT√âS PRINCIPALES FIREBASE -->

<script>
// üëâ Fonction d'initialisation principale qui s'ex√©cute quand la page est charg√©e
document.addEventListener("DOMContentLoaded", async function() {
  
  // ====================
  // 1. D√âCLARATION DES √âL√âMENTS DU DOM
  // ====================
  
  // üìå Onglets principaux de navigation
  const tabs = {
    home: document.getElementById("home"),    // Onglet Accueil
    cours: document.getElementById("cours"),    // Onglet Accueil
    list: document.getElementById("list"),
    chat: document.getElementById("chat"),// Onglet Liste des articles
    admin: document.getElementById("admin")   // Onglet Admin (futur usage)
  };

  // üìå √âl√©ments pour afficher les articles et d√©tails
  const listData = document.getElementById("listData");      // Conteneur de la liste
  const detailList = document.getElementById("detailList");  // Conteneur des d√©tails
  const dTitle = document.getElementById("dTitle");          // Titre dans les d√©tails
  const dSummary = document.getElementById("dSummary");      // R√©sum√© dans les d√©tails
  const dDescription = document.getElementById("dDescription"); // Description compl√®te
  const dMedia = document.getElementById('dMedia');          // Conteneur m√©dia (d√©tails)
  const backBtn = document.getElementById("backBtn");        // Bouton retour
  const articleCountEl = document.getElementById('articleCount'); // Compteur d'articles
  
  const userCountEl = document.getElementById('userCount'); // Compteur d'articles
  const listCategoriesEls = document.querySelectorAll(".listCategories"); // Boutons cat√©gories

  // üìå R√©f√©rence √† la base de donn√©es Firebase
  const dbRef = firebase.database().ref("RJFORDROID/CHAINE/RJfordroid");
const dbRefUser = firebase.database().ref("RJFORDROID/USERS");

  // üìå Variables globales
  let ALL_LIST_ITEMS = {};      // Tous les articles charg√©s
  let CURRENT_CATEGORY = "ALL"; // Cat√©gorie active
  let isListLoaded = false;     // Indicateur si la liste est charg√©e

  // ====================
  // 2. FONCTION D'INITIALISATION
  // ====================
  
 function initApp() {
  updateArticleCount();
  updateUsersCount();

  // Charger cat√©gories Home
  dbRef.once("value").then(snapshot => {
    if (snapshot.exists()) {
      renderHomeCategoryButtons(snapshot.val());
    }
  });

  // üîó Lecture URL
  const params   = new URLSearchParams(window.location.search);
  const tabParam = params.get("tab");
  const idParam  = params.get("id");

  // üß† Priorit√© logique
  if (idParam) {
    // Article pr√©cis ‚Üí liste + d√©tail
    showTab("list");
    showDetail(idParam);
  }
  else if (tabParam && tabs[tabParam]) {
    // Tab demand√©
    showTab(tabParam);
  }
  else {
    // D√©faut
    showTab("home");
  }
}
  // ====================
  // 3. FONCTIONS UTILITAIRES
  // ====================

  // üîÑ Met √† jour le compteur d'articles
  function updateArticleCount() {
    dbRef.once("value").then(snapshot => {
      const data = snapshot.val();
      const count = data ? Object.keys(data).length : 0;
      if(articleCountEl) articleCountEl.innerText = count;
    });
  }
  
    // üîÑ Met √† jour le compteur users
  function updateUsersCount() {
    dbRefUser.once("value").then(snapshot => {
      const data = snapshot.val();
      const count = data ? Object.keys(data).length : 0;
      if(userCountEl) userCountEl.innerText = count;
    });
  }

  // üé¨ V√©rifie si une cha√Æne est une URL YouTube
  function isYouTubeVideo(value) {
    return /^(https?:\/\/)?(www\.)?(youtube\.com|youtu\.be)/.test(value) 
           || /^[a-zA-Z0-9_-]{11}$/.test(value);
  }

  // üîç Extrait l'ID YouTube d'une URL ou d'une cha√Æne
  function getYouTubeId(value) {
    if (/^[a-zA-Z0-9_-]{11}$/.test(value)) return value;

    const match = value.match(
      /(?:youtube\.com\/(?:watch\?v=|embed\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/
    );
    return match ? match[1] : null;
  }

  // ====================
  // 4. GESTION DES CAT√âGORIES
  // ====================

  // üè† Affiche les boutons de cat√©gories dans l'onglet Home
  function renderHomeCategoryButtons(data) {
    const categories = new Set();
    Object.values(data).forEach(item => {
      if (item.category) categories.add(item.category);
    });

    let html = `<button onclick="loadListByCategory('Articles')" class="cat-btn active">
                  üìù Articles
                </button>`;

    categories.forEach(cat => {
      // Attribue des ic√¥nes selon la cat√©gorie
      let icon = "üìå"; // Ic√¥ne par d√©faut
      if (cat === "Formation") icon = "üíª";
      if (cat === "Articles") icon = "üì∞";
      if (cat === "Prompt") icon = "‚ö°";

      html += `<button onclick="loadListByCategory('${cat}')" class="cat-btn">
                 ${icon} ${cat}
               </button>`;
    });

    const homeEl = document.getElementById("homeCategories");
    if (homeEl) homeEl.innerHTML = html;
  }

  // üìã Affiche les boutons de cat√©gories dans la liste
  function renderListCategoryButtons(data) {
    const categories = new Set();

    Object.values(data).forEach(item => {
      if (item.category) categories.add(item.category);
    });

    let html = `
      <button onclick="loadListByCategory('ALL')" class="cat-btn all-btn">
        Tous
      </button>
    `;

    categories.forEach(cat => {
      html += `
        <button onclick="loadListByCategory('${cat}')" class="cat-btn">
          ${cat}
        </button>
      `;
    });

    // Injecte les boutons dans tous les √©l√©ments ayant la classe .listCategories
    listCategoriesEls.forEach(el => {
      el.innerHTML = html;
    });
  }

  // üåê Fonction globale pour charger les articles par cat√©gorie
  window.loadListByCategory = function(category = "ALL") {
    CURRENT_CATEGORY = category;

    // Change automatiquement vers l'onglet Liste
    showTab('list');

    // Affiche les articles de la cat√©gorie s√©lectionn√©e
    renderListItems(ALL_LIST_ITEMS);

    // Met √† jour l'apparence des boutons de cat√©gorie
    const btns = document.querySelectorAll('#homeCategories .cat-btn, .listCategories .cat-btn');
    btns.forEach(btn => btn.classList.remove('active'));
    btns.forEach(btn => {
      if(btn.textContent === category || (category === "ALL" && btn.classList.contains('all-btn'))) {
        btn.classList.add('active');
      }
    });
  };

  // ====================
  // 5. CHARGEMENT DES ARTICLES
  // ====================

  // üì• Charge la liste compl√®te des articles
  async function loadList() {
    listData.innerHTML = '<p>Chargement...</p>';
    
    try {
      const snapshot = await dbRef.once("value");
      const data = snapshot.val();

      if (!data) {
        listData.innerHTML = "<p>Aucun article trouv√©.</p>";
        return;
      }

      ALL_LIST_ITEMS = data; // Stocke tous les articles

      // Affiche les boutons de cat√©gories
      renderListCategoryButtons(data);

      // D√©finit la cat√©gorie par d√©faut
      if (!CURRENT_CATEGORY) {
        CURRENT_CATEGORY = "Article";
      }

      // Affiche les articles
      renderListItems(data);
      isListLoaded = true;

    } catch (error) {
      console.error("Erreur de chargement:", error);
      listData.innerHTML = "<p>Erreur de chargement</p>";
    }
  }

  // üé® Affiche les articles dans la liste principale
  function renderListItems(data) {
    if (!listData) return;

    listData.innerHTML = '';

    const items = Object.entries(data);
    if (items.length === 0) {
      listData.innerHTML = "<p>Aucun article trouv√©.</p>";
      return;
    }

    // D√©finit les couleurs des badges par cat√©gorie
    function getCategoryColor(category) {
      const colors = {
        Formation: "#28a745",
        Prompt: "#ffc107",
        News: "#17a2b8",
        Autre: "#6c757d"
      };
      return colors[category] || "#6c757d";
    }

    // Parcourt chaque article et cr√©e son √©l√©ment HTML
    items.forEach(([id, item]) => {
      if (CURRENT_CATEGORY !== "ALL" && item.category !== CURRENT_CATEGORY) return;

      const div = document.createElement('div');
      div.className = "list-item";
      div.dataset.id = id;

      const category = item.category || "Autre";
      const categoryColor = getCategoryColor(category);

      // üîπ G√âN√âRATION DU CONTENU M√âDIA
      let mediaHtml = "";

      // Image
      if (item.image) {
        mediaHtml += `
          <img src="${item.image}" 
               class="media-image" 
               alt="${item.title || ''}">
        `;
      }

      // Vid√©o
      if (item.video) {
        if (isYouTubeVideo(item.video)) {
          const ytId = getYouTubeId(item.video);
          if (ytId) {
            mediaHtml += `
              <div class="media-video youtube">
                <iframe
                  src="https://www.youtube.com/embed/${ytId}"
                  frameborder="0"
                  allowfullscreen>
                </iframe>
              </div>
            `;
          }
        } else {
          mediaHtml += `
            <video class="media-video" controls>
              <source src="${item.video}">
            </video>
          `;
        }
      }

      // Audio
      if (item.audio) {
        mediaHtml += `
          <audio class="media-audio" controls>
            <source src="${item.audio}">
          </audio>
        `;
      }

      // üîπ HTML COMPLET DE L'ARTICLE
      div.innerHTML = `
        <div class="badge-wrapper">
          <span class="category-badge" style="background:${categoryColor}">
            ${category}
          </span>
        </div>

        <h3>${item.title || "Sans titre"}</h3>
        ${mediaHtml}
        <p>${item.summary || ""}</p>

        <div class="actions">
          <button class="likeBtn">
            üëç Like <span class="count">${item.likes || 0}</span>
          </button>
          <button class="shareBtn">
            üîó Partager <span class="count">${item.shares || 0}</span>
          </button>
          <button class="detailBtn" data-id="${id}">
            Voir d√©tails
          </button>
        </div>
      `;

      // ‚ú® GESTION DES INTERACTIONS

      // Bouton Like
      div.querySelector(".likeBtn").addEventListener("click", async () => {
        const newCount = (item.likes || 0) + 1;
        await dbRef.child(id).update({ likes: newCount });
        item.likes = newCount;
        div.querySelector(".likeBtn .count").innerText = newCount;
      });

      // Bouton Partager
      div.querySelector(".shareBtn").addEventListener("click", async () => {
        const newCount = (item.shares || 0) + 1;
        await dbRef.child(id).update({ shares: newCount });
        item.shares = newCount;
        div.querySelector(".shareBtn .count").innerText = newCount;
        await shareArticle(item, id); // Lance le partage
      });

      // Bouton D√©tails
      div.querySelector(".detailBtn").addEventListener("click", e => {
        e.preventDefault();
        e.stopPropagation();
        showDetail(id);
        history.pushState(null, "", `?id=${id}`); // Met √† jour l'URL
      });

      listData.appendChild(div);
    });
  }

  // ====================
  // 6. GESTION DES D√âTAILS D'ARTICLE
  // ====================

  // üîç Affiche les d√©tails complets d'un article
  window.showDetail = async function(firebaseId) {
    try {
      const snap = await dbRef.child(firebaseId).once("value");
      if (!snap.exists()) return;

      const raw = snap.val();

      // Structure les donn√©es de l'article
      const data = {
        title: raw.title || '',
        summary: raw.summary || '',
        description: raw.description || '',
        image: raw.image || null,
        video: raw.video || null,
        audio: raw.audio || null
      };

      // Affiche les informations textuelles
      dTitle.textContent = data.title;
      dSummary.textContent = data.summary;
      dDescription.innerHTML = data.description;

      // R√©cup√®re les √©l√©ments m√©dia
      let img   = document.getElementById("dImage");
      let video = document.getElementById("dVideo");
      let audio = document.getElementById("dAudio");

      // R√©initialise les m√©dias pr√©c√©dents
      if (video) video.pause();
      if (audio) audio.pause();

      img.style.display = "none";
      video.style.display = "none";
      audio.style.display = "none";

      img.src = "";
      video.src = "";
      audio.src = "";

      // Gestion de la vid√©o
      if (data.video) {
        if (isYouTubeVideo(data.video)) {
          const ytId = getYouTubeId(data.video);
          if (ytId) {
            video.outerHTML = `
              <iframe id="dVideo"
                src="https://www.youtube.com/embed/${ytId}"
                frameborder="0"
                allowfullscreen
                style="width:100%;height:250px">
              </iframe>
            `;
          }
        } else {
          video.src = data.video;
          video.load();
          video.style.display = "block";
        }
      } 
      // Si pas de vid√©o mais une image
      else if (data.image) {
        img.src = data.image;
        img.style.display = "block";
      }

      // Gestion de l'audio
      if (data.audio) {
        audio.src = data.audio;
        audio.load();
        audio.style.display = "block";
      }

      // Affiche la section d√©tails et masque la liste
      listData.style.display = "none";
      detailList.style.display = "block";
       saveVisit(firebaseId);
      // ====================
      // 7. GESTION DES COMMENTAIRES
      // ====================

      // Supprime l'ancienne section commentaires si elle existe
      const oldComments = document.getElementById("commentsSection");
      if (oldComments) oldComments.remove();

      // Cr√©e la nouvelle section commentaires
      const commentsSection = document.createElement("div");
      commentsSection.id = "commentsSection";
      commentsSection.style.marginTop = "20px";
      commentsSection.innerHTML = `
        <h3>üí¨ Commentaires</h3>
        <div id="commentsList" style="margin-bottom:10px;"></div>
        <textarea id="commentInput"
          placeholder="√âcris ton commentaire..."
          style="width:100%;min-height:60px;"></textarea>
        <button id="sendCommentBtn" style="margin-top:5px;">Envoyer</button>
        <p id="commentNotice" style="color:red; margin-top:5px;"></p>
      `;
      detailList.appendChild(commentsSection);

      // R√©cup√®re les √©l√©ments de la section commentaires
      const commentsList = document.getElementById("commentsList");
      const commentInput = document.getElementById("commentInput");
      const sendBtn = document.getElementById("sendCommentBtn");
      const commentNotice = document.getElementById("commentNotice");
      const commentsRef = dbRef.child(firebaseId).child("comments");

      // üîÑ Charge et affiche les commentaires existants
      commentsRef.off(); // D√©sactive les anciens √©couteurs
      commentsRef.on("value", snap => {
        commentsList.innerHTML = "";
        if (!snap.exists()) {
          commentsList.innerHTML = "<p>Aucun commentaire.</p>";
          return;
        }

        // Affiche chaque commentaire
        snap.forEach(c => {
          const val = c.val();
          const div = document.createElement("div");

          // V√©rifie si c'est l'utilisateur actuel
          const isSelf = currentUser && val.user === currentUser.username;

          div.className = isSelf ? "comment-bubble self" : "comment-bubble other";

          const date = new Date(val.date || Date.now());
          div.innerHTML = `
            <span class="username">${val.user || "Utilisateur"}</span>
            <p>${val.text}</p>
            <span class="date">${date.toLocaleString()}</span>
          `;
          commentsList.appendChild(div);
        });
      });

      // V√©rifie si l'utilisateur est connect√©
      if (!currentUser) {
        commentInput.disabled = true;
        sendBtn.disabled = true;
        commentNotice.textContent = "Connectez-vous pour poster un commentaire.";
      } else {
        commentInput.disabled = false;
        sendBtn.disabled = false;
        commentNotice.textContent = "";

        // Envoi d'un nouveau commentaire
        sendBtn.onclick = async () => {
          const text = commentInput.value.trim();
          if (!text) return;

          commentsRef.push({
            text,
            user: currentUser.username || "Utilisateur",
            date: Date.now()
          });

          commentInput.value = ""; // Vide le champ
        };
      }

    } catch (err) {
      console.error("Erreur showDetail:", err);
    }
  };

  // ====================
  // 8. FONCTIONS DE PARTAGE
  // ====================

  // üîó Partage un article
  async function shareArticle(item, urlId) {
    const shareUrl = `${window.location.origin}${window.location.pathname}?id=${urlId}`;
    const shareData = {
      title: item.title,
      text: item.summary,
      url: shareUrl
    };

    // Utilise l'API Web Share si disponible
    if (navigator.share) {
      try {
        await navigator.share(shareData);
      } catch (error) {
        if (error.name !== 'AbortError') {
          console.log("Partage annul√©");
        }
      }
    } else {
      // Fallback: copie dans le presse-papier
      try {
        await navigator.clipboard.writeText(`${item.title}\n\n${item.summary}\n\n${shareUrl}`);
        showPopup("Lien copi√© ! Partagez-le üî•");
      } catch (error) {
        console.error("Erreur copie:", error);
      }
    }
  }

  // üí¨ Affiche un message popup temporaire
  function showPopup(message) {
    const popup = document.createElement('div');
    popup.className = 'popup';
    popup.textContent = message;
    popup.style.cssText = `
      position: fixed;
      top: 20px;
      right: 20px;
      background: #4CAF50;
      color: white;
      padding: 15px;
      border-radius: 5px;
      z-index: 1000;
    `;
    
    document.body.appendChild(popup);
    
    setTimeout(() => {
      popup.remove();
    }, 3000);
  }

  // ====================
  // 9. GESTION DE LA NAVIGATION
  // ====================

  // ‚¨ÖÔ∏è Bouton retour √† la liste
  if (backBtn) {
    backBtn.addEventListener("click", () => {
      if (detailList) detailList.style.display = 'none';
      if (listData) {
        listData.style.display = 'flex';
        listData.style.flexDirection = 'column';
      }
      history.pushState(null, '', window.location.pathname); // Nettoie l'URL
    });
  }

  // üì± Changement d'onglet
window.showTab = function(tabName) {
  if (!tabs[tabName]) return;

  // Cache tous les tabs
  Object.values(tabs).forEach(t => t.classList.remove("active"));

  // Active le bon tab
  tabs[tabName].classList.add("active");

  // üîó Met √† jour l‚ÄôURL
 const currentTab = new URLSearchParams(location.search).get("tab");

if (currentTab !== tabName) {
  history.pushState(null, "", `?tab=${tabName}`);
}
  // Actions sp√©cifiques
  if (tabName === 'list') {
    loadList();
  }
};

  // üîó √âcouteurs pour la navigation principale
  document.getElementById("btnHome")?.addEventListener("click", () => showTab('home'));
  document.getElementById("btnCours")?.addEventListener("click", () => showTab('cours'));
  document.getElementById("btnList")?.addEventListener("click", () => showTab('list'));
  document.getElementById("btnChat")?.addEventListener("click", () => showTab('chat'));
  document.getElementById("btnAdmin")?.addEventListener("click", () => showTab('admin'));

  // üì± Bouton d'abonnement WhatsApp
  document.getElementById("btnSubscribe")?.addEventListener("click", () => {
    window.open("https://whatsapp.com/channel/0029VadhmlpEAKWIRzYyWt0a", "_blank");
  });

  // ====================
  // 10. GESTION DE L'HISTORIQUE
  // ====================

  // Permet d'utiliser les boutons pr√©c√©dent/suivant du navigateur
  window.addEventListener("popstate", () => {
  const params = new URLSearchParams(window.location.search);
  const tab = params.get("tab") || "home";
  showTab(tab);
});
  window.addEventListener('popstate', function() {
    const params = new URLSearchParams(window.location.search);
    const idParam = params.get('id');
    
    if (!idParam && detailList && detailList.style.display === 'block') {
      detailList.style.display = 'none';
      if (listData) {
        listData.style.display = 'flex';
        listData.style.flexDirection = 'column';
      }
    }
  });

  // ====================
  // 11. LANCEMENT DE L'APPLICATION
  // ====================
  initApp();
});
</script>

<!-- ==================== -->
<!-- VID√âO PRINCIPALE HOME -->
<!-- ==================== -->

<script>
// üìå R√©f√©rence √† la vid√©o principale dans Firebase
const videoHomeRef = firebase.database().ref("RJFORDROID/VIDEO/Home/");

// üìå √âl√©ments du DOM pour la vid√©o
const videoSpace = document.getElementById("videoSpace");
const homeVideoTitle = document.getElementById("homet");
const homeVideoSummary = document.getElementById("homes");

// üîç Extrait l'ID YouTube d'une URL ou d'une cha√Æne
function extractYouTubeId(input){
  if(!input) return null;

  const regExp = /(?:youtube\.com\/.*v=|youtu\.be\/)([^&]+)/;
  const match = input.match(regExp);
  return match ? match[1] : input;
}

// üé¨ Charge la vid√©o principale sur la page d'accueil
function loadHomeVideo(){
  videoHomeRef
    .orderByChild("online")          // Filtre par statut "online"
    .equalTo(true)                   // Uniquement les vid√©os actives
    .limitToLast(1)                  // La derni√®re vid√©o active
    .once("value", snapshot => {

      if(!snapshot.exists()){
        videoSpace.innerHTML = "üé• Aucune vid√©o disponible";
        return;
      }

      snapshot.forEach(child => {
        const v = child.val();

        const videoId = extractYouTubeId(v.url);

        // üîπ Injection de l'iframe YouTube
        videoSpace.innerHTML = `
          <iframe 
            width="100%" 
            height="180"
            src="https://www.youtube.com/embed/${videoId}"
            frameborder="0"
            allowfullscreen>
          </iframe>
        `;

        // üîπ Affichage du titre et du r√©sum√©
        homeVideoTitle.innerText = v.title || "";
        homeVideoSummary.innerText = v.summary || "";
      });
    });
}

// üöÄ Charge la vid√©o au d√©marrage
loadHomeVideo();
</script>
</body>
</html>